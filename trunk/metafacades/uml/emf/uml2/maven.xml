<project default="jar:install"
         xmlns:ant="jelly:ant"
         xmlns:j="jelly:core"
         xmlns:artifact="artifact">
    <!-- ==================================================================
           Add the META-INF/andromda/namespace.xml to the UML 1.4 jar
           (it can't be contained in the uml common jar because of the
           fact that the andromda-metafacades.xml are registered per UML version
         ================================================================== -->
    <preGoal name="jar:jar">
        <ant:copy todir="${maven.build.dest}">
            <ant:fileset dir="../../common/src">
                <ant:include name="META-INF/andromda/namespace.ent"/>
                <ant:include name="META-INF/andromda/profile.xml"/>
            </ant:fileset>
        </ant:copy>
    </preGoal>
    
             
    <!-- ===================================================================
         Install the model into the repository
         =================================================================== -->
  	<postGoal name="jar:install">
  	    <attainGoal name="xml.zip:prepare"/>
	    <artifact:install
	        artifact="${maven.xml.zip.final.name}.xml.zip"
	        type="xml.zip"
	        project="${pom}"/> 
  	</postGoal>
  	
    <!-- ===================================================================
         Deploy the model into the remote repository
         =================================================================== -->
  	<postGoal name="jar:deploy">
  	    <attainGoal name="xml.zip:prepare"/>
	    <artifact:deploy
	        artifact="${maven.xml.zip.final.name}.xml.zip"
	        type="xml.zip"
	        project="${pom}"/>   	
  	</postGoal>
  	
    <!-- ===================================================================
         Prepare the xml.zip for install/deploy
         =================================================================== --> 	
  	<goal name="xml.zip:prepare">
  	   <j:set var="modelName" value="${pom.artifactId}"/>
	   <j:set var="maven.xml.zip.final.name" 
	          value="${maven.build.dir}/${maven.final.name}"/>
  	    <j:set var="modelXml" value="${modelName}.xml"/>
		<ant:unzip 
		    src="${maven.src.dir}/uml/${modelXml}.zip" 
		    dest="${maven.build.dir}"/>
		<ant:move
		    file="${maven.build.dir}/${modelXml}"
		    tofile="${maven.xml.zip.final.name}.xml"/>
	    <ant:zip destfile="${maven.xml.zip.final.name}.xml.zip"
	             basedir="${maven.build.dir}"
	             includes="*.xml"/>	 	
  	</goal>
    
</project>
