// license-header java merge-point
//
// Attention: Generated code! Do not modify by hand!
// Generated by test/EntityCreate.vsl in andromda-ejb3-cartridge.
//
package org.andromda.timetracker.domain;

import java.util.List;
import javax.persistence.EntityManager;
import javax.persistence.TypedQuery;
//import org.andromda.dbtest.JPAJUnitAncestor;
import org.apache.log4j.LogManager;
import org.apache.log4j.Logger;

import java.util.Date;
import java.util.HashSet;
import java.util.Set;

/**
 * Autogenerated Entity constructor class for User which creates
 * an Entity instance using dummy/default values for all properties, with a method for
 * minimal properties (only required), all properties, and an update from minimal to update the rest of the properties.
 * It assumes that Entities only have relations to other entities, so those constructors can be used.
 *
 * Autogenerated by AndroMDA ejb3\test\EntityConstructor.vsl on 01/17/2014 23:56:44
 *
 * <p>
 * TODO: Model Documentation for User
 * </p>
 */
public class UserCreate
{
    private static Logger LOGGER = LogManager.getLogger(UserCreate.class);

    /**
     * Create an Entity User with all attributes and associations set
     * @param em EntityManager used within this transaction
     * @return User
     */
    public static User createEntity(EntityManager em)
    {
        User entity = new User();
        // Identifier attributes

        //EntityManager em = javax.persistence.Persistence.createEntityManagerFactory(org.andromda.dbtest.JPAJUnitAncestor.PERSISTENCE_UNIT).createEntityManager();
        // Entity Associations which need to be retrieved
        UserRole roles = UserRoleCreate.findFirst(em);
        roles = em.merge(roles);
        LOGGER.info("User.createEntity merged: " + roles);
        Set<UserRole> rolesList = new HashSet<UserRole>();
        rolesList.add(roles);
        entity.setRoles(rolesList);

        // Updatable property
        entity.setUsername("username");
        // Updatable property
        entity.setFirstName("firstName");
        // Updatable property
        entity.setLastName("lastName");
        // Updatable property
        entity.setPassword("password");
        // Updatable property
        entity.setEmail("email");
        // Updatable property
        entity.setIsActive(true);
        // Updatable property
        entity.setCreationDate(new Date());
        // Updatable property
        entity.setComment("comment");

        return entity;
    }

    /**
     * Create an Entity User with all attributes and associations set
     * @param em EntityManager used to findAll
     * @return User
     */
    public static List<User> findAll(EntityManager em)
    {
        //EntityManager em = JPAJUnitAncestor.createEntityManager();
        TypedQuery<User> query = em.createNamedQuery("User.findAll", User.class);
        List<User> results = query.getResultList();
        return results;
    }

    /**
     * Return a persisted Entity User with all attributes and associations set
     * Used to set persistent association relationships in related entities.
     * @param em EntityManager used to findFirst
     * @return User
     */
    public static User findFirst(EntityManager em)
    {
        User entity = null;
        //EntityManager em = JPAJUnitAncestor.createEntityManager();
        TypedQuery<User> query = em.createNamedQuery("User.findAll", User.class);
        List<User> results = query.getResultList();
        if (!results.isEmpty())
        {
            entity = results.get(0);
        }
        else
        {
            entity = createEntity(em);
            em.persist(entity);
        }
        return entity;
    }
}