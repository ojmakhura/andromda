<project xmlns:j="jelly:core"
  		 xmlns:ant="jelly:ant"
  		 xmlns:artifact="artifact"
  		 xmlns:velocity="jelly:velocity">
  		 
   <preGoal name="jar:jar">
   	
		<!-- perform the merges so we can insert the current
		     AndroMDA version into the maven plugin each time we build -->
	    <velocity:merge
			name="${maven.build.dest}/project.xml"
			basedir="${basedir}"
			template="/project.xml"/>     
	    <velocity:merge
			name="${maven.build.dest}/plugin.properties"
			basedir="${basedir}"
			template="/plugin.properties"/> 
				
  		<!-- perform the below merges so we can add the 
  			 current version of AndroMDA to the mda genapp module -->
		<j:set 
			var="mdaResourcesDir" 
			value="plugin-resources/andromda/templates/j2ee-app/mda"/>
		<j:set 
			var="mdaTemplatesDir" 
			value="${basedir}/${mdaResourcesDir}"/>
	    <velocity:merge
			name="${maven.build.dest}/${mdaResourcesDir}/project-ejb.xml.vm"
			basedir="${mdaTemplatesDir}"
			template="/project-ejb.xml.vm"/>  
	    <velocity:merge
			name="${maven.build.dest}/${mdaResourcesDir}/project-hibernate.xml.vm"
			basedir="${mdaTemplatesDir}"
			template="/project-hibernate.xml.vm"/> 	
					
   </preGoal>
  	
  	<!-- this is here because the plugin:install goal from the
  		 maven-plugin-plugin doesn't copy to the 
  		 '${maven.repo.local}/plugins' directory -->
  	<goal name="plugin:install" >
  		  		
    	<attainGoal name="jar:jar"/>
		<ant:copy todir="${maven.home}/plugins">
			<ant:fileset dir="target">
				<include name="*.jar"/>
			</ant:fileset>
		</ant:copy>	
		<artifact:install 
			artifact="${maven.build.dir}/${maven.final.name}.jar" 
			type="plugin" 
			project="${pom}"/>	
  	</goal>

</project>
