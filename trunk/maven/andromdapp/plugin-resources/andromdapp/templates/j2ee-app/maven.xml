<project default="install"
         xmlns:ant="jelly:ant"
         xmlns:maven="jelly:maven"
         xmlns:j="jelly:core">
         
  	<!-- ==================================================================
  			 Builds everything and installs it into the local Maven repository                                                   
  		 ================================================================== -->
  	<goal name="install">
		<attainGoal name="multiproject:install"/>	
  	</goal> 
  	
  	<!-- ==================================================================
  			 Cleans Everything                                                 
  		 ================================================================== -->
  	<goal name="clean">  		
		<attainGoal name="multiproject:clean"/>
		<!-- get rid of all the log files -->
		<ant:delete>
			<ant:fileset dir=".">
				<ant:include name="**/*.log*"/>
				<ant:exclude name="maven.log"/>
			</ant:fileset>
		</ant:delete>
  	</goal> 

   	<!-- ==================================================================
			Deploy the Application                                                  
  		 ================================================================== --> 	 
	<goal name="deploy-app">
		<maven:maven
			descriptor="${basedir}/app/project.xml"
			goals="deploy"/>
	</goal>
	
   	<!-- ==================================================================
			Undeploy the Application                                                  
  		 ================================================================== --> 
	<goal name="undeploy-app">
		<maven:maven
			descriptor="${basedir}/app/project.xml"
			goals="undeploy"/>
	</goal>  	  	  
	
   	<!-- ==================================================================
			Builds the Web component                                                  
  		 ================================================================== --> 
	<goal name="web">
		<maven:maven
			descriptor="${basedir}/web/project.xml"
			goals="war:install"/>
	</goal>	
	
   	<!-- ==================================================================
			Builds the Core component                                                  
  		 ================================================================== --> 
	<goal name="core">
		<maven:maven
			descriptor="${basedir}/core/project.xml"
			goals="ejb:install"/>
	</goal>	
	
   	<!-- ==================================================================
			Builds the Common component                                                  
  		 ================================================================== --> 
	<goal name="common">
		<maven:maven
			descriptor="${basedir}/common/project.xml"
			goals="jar:install"/>
	</goal>	
	
   	<!-- ==================================================================
			Runs the MDA component                                                  
  		 ================================================================== --> 
	<goal name="mda">
		<maven:maven
			descriptor="${basedir}/mda/project.xml"
			goals="pom:install"/>
	</goal>	
  
   	<!-- ==================================================================
			Adds the generated source to the compile path (if any exists)                                                  
  		 ================================================================== -->   
  	<preGoal name="java:compile">
  		
        <!-- only attempt to add the generated source if we have a source
             directory -->
        <j:set var="sourceDirectory" value="${pom.build.sourceDirectory}"/>
            <j:if test="${sourceDirectory != null and sourceDirectory != ''}">
           
                <ant:available
                    file="${sourceDirectory}"
                    type="dir"
                    property="srcAvailable"/>  
                
            <j:if test="${srcAvailable != null}">         
                <!-- only attempt to add the generated source if it exists -->
                <j:set var="generatedSrc" value="${maven.build.src}"/>
                <j:if test="${generatedSrc != null and generatedSrc != ''}">
                    <!-- add the paths of the generated source to the
                         maven compile path -->
                    <ant:path
                        id="andromda.java.gen.src"
                        location="${generatedSrc}"/>
                    <maven:addPath
                        id="maven.compile.src.set"
                        refid="andromda.java.gen.src"/>
                </j:if>
            </j:if>
        </j:if>
        
  	</preGoal>
	
</project>
