// license-header java merge-point
//
// Generated by: MetafacadeLogicImpl.vsl in andromda-meta-cartridge.
package org.andromda.cartridges.angular.metafacades;

import java.util.List;
import java.util.Objects;

import org.andromda.cartridges.angular.AngularGlobals;
import org.andromda.cartridges.angular.AngularUtils;
import org.andromda.metafacades.uml.FrontEndParameter;
import org.andromda.metafacades.uml.ModelElementFacade;
import org.andromda.metafacades.uml.ParameterFacade;
import org.apache.commons.lang3.StringUtils;

/**
 * Represents an operation for a Angular controller. MetafacadeLogic
 * implementation for
 * org.andromda.cartridges.angular.metafacades.AngularControllerOperation.
 *
 * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation
 */
public class AngularControllerOperationLogicImpl
    extends AngularControllerOperationLogic
{
    private static final long serialVersionUID = 34L;
    /**
     * Public constructor for AngularControllerOperationLogicImpl
     * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation
     */
    public AngularControllerOperationLogicImpl (Object metaObject, String context)
    {
        super(metaObject, context);
    }

    /**
     * @return formName
     * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation#getFormName()
     */
    protected String handleGetFormName()
    {
        final String pattern = Objects.toString(this.getConfiguredProperty(AngularGlobals.FORM_PATTERN), "");
        return pattern.replaceFirst("\\{0\\}", StringUtils.capitalize(this.getName()));
    }

    /**
     * @return fullyQualifiedFormName
     * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation#getFullyQualifiedFormName()
     */
    protected String handleGetFullyQualifiedFormName()
    {
        final StringBuilder fullyQualifiedName = new StringBuilder();
        final String packageName = this.getPackageName();
        if (StringUtils.isNotBlank(packageName))
        {
            fullyQualifiedName.append(packageName + '.');
        }
        return fullyQualifiedName.append(StringUtils.capitalize(this.getFormName())).toString();
    }

    /**
     * @return getFullyQualifiedFormName().replace('.', '/')
     * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation#getFullyQualifiedFormPath()
     */
    protected String handleGetFullyQualifiedFormPath()
    {
        return this.getFullyQualifiedFormName().replace('.', '/');
    }

    /**
     * @return formCall
     * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation#getFormCall()
     */
    protected String handleGetFormCall()
    {
        final StringBuilder call = new StringBuilder();
        call.append(this.getName());
        call.append("(");
        if (!this.getFormFields().isEmpty())
        {
            // StringBuilder b = new StringBuilder();

            // for(FrontEndParameter param : this.getFormFields()) {
                
            //     if(b.length() > 0) {
            //         b.append(", ");
            //     }

            //     b.append(param.getName());
            // }

            call.append("form");
            // call.append(b.toString());
        }
        call.append(")");
        return call.toString();
    }

    /**
     * @return getFormSignature(false)
     * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation#getImplementationFormSignature()
     */
    protected String handleGetImplementationFormSignature()
    {
        return this.getFormSignature(false);
    }

    /**
     * @return getFormSignature(true)
     * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation#getFormSignature()
     */
    protected String handleGetFormSignature()
    {
        return this.getFormSignature(true);
    }

    /**
     * Constructs the signature that takes the form for this operation.
     *
     * @param isAbstract whether or not the signature is abstract.
     * @return the appropriate signature.
     */
    private String getFormSignature(boolean isAbstract)
    {
        final StringBuilder signature = new StringBuilder();
        signature.append(this.getVisibility() + ' ');
        if (isAbstract)
        {
            signature.append("abstract ");
        }
        
        signature.append(this.getName() + "(");
        if (!this.getFormFields().isEmpty())
        {
            signature.append("form: any");
        }

        signature.append(")");
        
        final ModelElementFacade returnType = this.getReturnType();
        signature.append(returnType != null ? ": " + AngularUtils.getDatatype(returnType.getFullyQualifiedName()) : null);
        return signature.toString();
    }
}