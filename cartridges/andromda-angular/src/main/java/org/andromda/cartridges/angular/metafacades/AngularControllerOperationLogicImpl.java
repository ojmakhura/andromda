// license-header java merge-point
//
// Generated by: MetafacadeLogicImpl.vsl in andromda-meta-cartridge.
package org.andromda.cartridges.angular.metafacades;

import java.util.Objects;

import org.andromda.cartridges.angular.AngularGlobals;
import org.andromda.metafacades.uml.ModelElementFacade;
import org.apache.commons.lang3.StringUtils;

/**
 * Represents an operation for a JSF controller. MetafacadeLogic implementation
 * for org.andromda.cartridges.angular.metafacades.AngularControllerOperation.
 *
 * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation
 */
public class AngularControllerOperationLogicImpl
    extends AngularControllerOperationLogic
{
    private static final long serialVersionUID = 34L;
    /**
     * Public constructor for AngularControllerOperationLogicImpl
     * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation
     */
    public AngularControllerOperationLogicImpl (Object metaObject, String context)
    {
        super(metaObject, context);
    }

    /**
     * The fully qualified path of the form file.
     * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation#getFullyQualifiedFormPath()
     */
    protected String handleGetFullyQualifiedFormPath()
    {
        return this.getFullyQualifiedFormName().replace('.', '/');
    }

    /**
     * The fully qualified form name.
     * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation#getFullyQualifiedFormName()
     */
    protected String handleGetFullyQualifiedFormName()
    {
        final StringBuilder fullyQualifiedName = new StringBuilder();
        final String packageName = this.getPackageName();
        if (StringUtils.isNotBlank(packageName))
        {
            fullyQualifiedName.append(packageName + '.');
        }
        return fullyQualifiedName.append(StringUtils.capitalize(this.getFormName())).toString();
    }

    /**
     * The form name the corresponds to this controller operation.
     * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation#getFormName()
     */
    protected String handleGetFormName()
    {
        final String pattern = Objects.toString(this.getConfiguredProperty(AngularGlobals.FORM_PATTERN), "");
        return pattern.replaceFirst("\\{0\\}", StringUtils.capitalize(this.getName()));
    }

    /**
     * The operation call that takes the appropriate form as an argument.
     * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation#getFormCall()
     */
    protected String handleGetFormCall()
    {
        final StringBuilder call = new StringBuilder();
        call.append(this.getName());
        call.append("(");
        if (!this.getFormFields().isEmpty())
        {
            call.append("form");
        }
        call.append(")");
        return call.toString();
    }

    /**
     * The controller operation signature that takes the appropriate form (if this operation has at
     * least one form field) as an argument.
     * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation#getFormSignature()
     */
    protected String handleGetFormSignature()
    {
        return this.getFormSignature(true);
    }

    /**
     * The controller implementation operation signature that takes the appropriate form (if this
     * operation has at least one form field) as an argument.
     * @see org.andromda.cartridges.angular.metafacades.AngularControllerOperation#getImplementationFormSignature()
     */
    protected String handleGetImplementationFormSignature()
    {
        return this.getFormSignature(false);
    }

    /**
     * Constructs the signature that takes the form for this operation.
     *
     * @param isAbstract whether or not the signature is abstract.
     * @return the appropriate signature.
     */
    private String getFormSignature(boolean isAbstract)
    {
        final StringBuilder signature = new StringBuilder();
        //signature.append(this.getVisibility() + ' ');
        if (isAbstract)
        {
            signature.append("abstract ");
        }
        signature.append(" " + this.getName() + "(");
        if (!this.getFormFields().isEmpty())
        {
            signature.append("form: " + this.getFormName());
        }
        signature.append("): ");

        final ModelElementFacade returnType = this.getReturnType();
        signature.append(returnType != null ? returnType.getFullyQualifiedName() : null);
        return signature.toString();
    }
}