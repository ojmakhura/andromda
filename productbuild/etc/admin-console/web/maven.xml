<project default="war:install"
    xmlns:ant="jelly:ant"
    xmlns:maven="jelly:maven">

    <ant:property environment="env"/>

    <goal name="deploy">
        <ant:copy file="${maven.build.dir}/${pom.artifactId}.war"
                  todir="${env.JBOSS_HOME}/server/${jboss.config}/deploy"/>
    </goal>

    <goal name="undeploy">
        <ant:delete file="${env.JBOSS_HOME}/server/${jboss.config}/deploy/${pom.artifactId}.war"/>
    </goal>

    <!-- =====================================================================
            Add the generated code on the classpath
         ===================================================================== -->
    <preGoal name="java:compile">
        <ant:path
            id="andromda.struts.gen.src"
            location="${maven.build.src}"/>
        <maven:addPath
            id="maven.compile.src.set"
            refid="andromda.struts.gen.src"/>
        <attainGoal name="castor:run"/>
    </preGoal>

    <goal name="castor:run">
        <ant:java classname="org.exolab.castor.builder.SourceGenerator" fork="true">
            <ant:arg value="-i"/>
            <ant:arg value="${admin.console.cfg.xml.xsd}"/>
            <ant:arg value="-package"/>
            <ant:arg value="${pom.package}.config.xml"/>
            <ant:arg value="-dest"/>
            <ant:arg value="${maven.build.src}"/>
            <ant:arg value="-f"/>
            <ant:classpath>
                <ant:path refid="maven.dependency.classpath"/>
            </ant:classpath>
        </ant:java>
    </goal>

    <postGoal name="war:init">
        <ant:copy todir="${maven.build.src}" overwrite="true">
            <ant:fileset dir="${maven.src.dir}/jsp"/>
            <ant:fileset dir="${maven.src.dir}/properties"/>
        </ant:copy>
        <ant:mkdir dir="${maven.build.src}/WEB-INF/classes"/>
        <ant:copy todir="${maven.build.src}/WEB-INF/classes" overwrite="true">
            <ant:fileset dir="${maven.src.dir}/xml">
                <ant:include name="*.cfg.xml"/>
            </ant:fileset>
        </ant:copy>
    </postGoal>

    <postGoal name="war:webapp">
        <ant:copy todir="${maven.war.webapp.dir}">
            <ant:fileset dir="${maven.build.src}">
                <ant:include name="**/*.gif"/>
                <ant:include name="**/*.png"/>
                <ant:include name="**/*.jpg"/>
                <ant:include name="**/*.js"/>
                <ant:include name="**/*.jsp"/>
                <ant:include name="**/*.jspf"/>
                <ant:include name="**/*.css"/>
                <ant:include name="WEB-INF/**/*"/>
            </ant:fileset>
        </ant:copy>
    </postGoal>

</project>
