<?xml version="1.0" encoding="iso-8859-1"?>
<document>
    <properties>
        <author email="mbohlen@mbohlen.de">Matthias Bohlen</author>
        <author email="chdbrandon@yahoo.com">Chad Brandon</author>
        <title>Writing a build script using AndroMDA</title>
    </properties>
    <body>
        <section name="The AndroMDA Ant Task">
            <p>
              One of the ways to use AndroMDA, is as a custom task for the famous 
              Apache Ant build tool. This page documents the attributes and 
              elements of the <![CDATA[<andromda>]]> task.
            </p>
            <h2>
                <a name="AndroMDA"><![CDATA[<andromda>]]></a>
            </h2>
            <p>
                andromda is the task that generates Java source (or other) files
                from templates and a metamodel that it loads from a text file 
                (i.e. an XMI file).
            </p>
            <p>
                To configure your cartridges you'll will use nested
                <a href="#namespace">
                    <code><![CDATA[<namespace>]]></code>
                </a> elements.
            </p>
            <p>
                To customize andromda's default behavior and to point to shared
                modules or profiles then you will possibly use a nested
                <a href="#repository">
                    <code><![CDATA[<repository>]]></code>
                </a> element.
            </p>
            <h3>Attributes</h3>
            <table>
                <tr>
                    <td>
                        <strong>Attribute</strong>
                    </td>
                    <td>
                        <strong>Description</strong>
                    </td>
                    <td align="center">
                        <strong>Required</strong>
                    </td>
                </tr>
                <tr>
                    <td>basedir</td>
                    <td>
                        Specifies the path to the directory location of your case 
                        tool's model file(s).
                        <strong>NOTE:</strong> if this
                        is NOT specified, you'll need to specify one or 
                        more nested <a href="#model"><![CDATA[<model/>]]></a>
                        elements to give the location(s) of the model(s) to load.
                    </td>
                    <td>
                        Yes (unless modelURL is used).
                    </td>
                </tr>
                <tr>
                    <td>
                        includes
                    </td>
                    <td>
                        This is the standard Ant includes 
                        attribute. Specify any files or directories with XMI files 
                        that you
                        <strong>do</strong> want AndroMDA to try to process.  This is
                        used in conjunction with the
                        <code>basedir</code> property.
                    </td>
                    <td align="center">
                        Yes (unless modelURL is used).
                    </td>
                </tr>
                <tr>
                    <td>
                        excludes
                    </td>
                    <td>
                        This is the standard Ant excludes 
                        attribute. Specify any files or directories with XMI files 
                        that you
                        <strong>do not</strong> want AndroMDA to try to process.  This is
                        used in conjunction with the
                        <code>basedir</code> property.
                    </td>
                    <td align="center">
                        No.
                    </td>
                </tr>
                <tr>
                    <td>
                        lastModifiedCheck
                    </td>
                    <td>
                        This turns on or off the ability 
                        to check the last modified date on files in order to 
                        determine whether or not they need to be re-rendered or 
                        not. The value of this attribute can be "true, false, yes, 
                        no". By default, it is true, meaning that the last modified 
                        date should be checked and if the original .xml file has 
                        not changed, then don't process the output file. This 
                        accelerates processing because files that have not changed 
                        will not get reprocessed.
                    </td>
                    <td align="center">
                        No, defaults to
                        <code>true</code>.
                    </td>
                </tr>
                <tr>
                    <td>
                        <a name="processAllModelPackages">processAllModelPackages</a>
                    </td>
                    <td>
                        Specifies whether or not to process/generate from all packages 
                        in the model, used in combination with the
                        <a href="#modelPackage">
                            <code><![CDATA[<modelPackage>]]></code>
                        </a> element.
                    </td>
                    <td>
                        No, defaults to
                        <code>true</code>.
                    </td>
                </tr>
                <tr>
                    <td>
                        <a name="modelValidation">modelValidation</a>
                    </td>
                    <td>
                        Specifies whether or not models loaded by AndroMDA will be
                        validated.  By default models <strong>WILL</strong> be validated, 
                        however sometimes its nice to turn off validation for performance 
                        reasons (i.e. you have very large model(s) being processed).
                    </td>
                    <td>
                        No, defaults to
                        <code>true</code>.
                    </td>
                </tr>
                <tr>
                    <td>
                        <a name="xmlValidation">xmlValidation</a>
                    </td>
                    <td>
                        Specifies whether or not XML resources loaded by AndroMDA will be
                        validated (such as XML plugin descriptors).  Sometimes underlying 
                        XML parsers don't support XML Schema validation and in that case, 
                        we want to be able to turn it off.
                    </td>
                    <td>
                        No, defaults to
                        <code>true</code>.
                    </td>
                </tr>
                <tr>
                    <td>
                        <a name="outputEncoding">outputEncoding</a>
                    </td>
                    <td>
                        Sets the encoding for all resulting model processing output.
                    </td>
                    <td>
                        No, defaults to the platform default encoding.
                    </td>
                </tr>
                <tr>
                    <td>
                        <a name="failOnModelValidationErrors">failOnModelValidationErrors</a>
                    </td>
                    <td>
                        Specifies whether or not model processing should fail when <strong>ANY</strong>
                        model validation errors are present.
                    </td>
                    <td>
                        No, defaults to <code>true</code>.
                    </td>
                </tr>
                <tr>
                    <td>
                        <a name="cartridgeFilter">cartridgeFilter</a>
                    </td>
                    <td>
                        A comma seperated list of cartridge names (i.e. namespaces) that
                        should be processed by AndroMDA.  If this is not defined, then 
                        <strong>ANY</strong> discovered cartridges will be processed.
                        This is useful when you want to restrict the cartridges that will
                        process the model, in order to speed up the development cycle. You can prefix
                        the list of cartridges using the tilde '~' character, that way
                        the cartridges that are *not* listed will be processed (negation).
                    </td>
                    <td>
                        No
                    </td>
                </tr>
                <tr>
                    <td>
                        <a name="loggingConfigurationUri">loggingConfigurationUri</a>
                    </td>
                    <td>
                        Specifies the location of an external logging configuration file.  This is useful if you want
                        to override the default logging behavior of AndroMDA.
                    </td>
                    <td>
                        No
                    </td>
                </tr>
            </table>
            <table>
                <h2>
                    <a name="model"><![CDATA[<model>]]></a>
                </h2>
                <p>
                    The
                    <code><![CDATA[<model/>]]></code> element is used to
                    tell AndroMDA to process a model. It can be used instead of the 
                    include and exclude attributes to point directly at the 
                    location of an XMI file. It is useful if the model file 
                    is in a JAR and you do not want to unzip the jar. Unlike 
                    include it can only be used to process one XMI file (however
                    you can define as many
                    <code><![CDATA[<model/>]]></code>
                    elements as you would like).
                </p>
                <p>
                    The model is optional if
                    <code>basedir</code> and
                    <code>includes</code> is defined.
                </p>
                <tr>
                    <td>
                        <strong>Attribute</strong>
                    </td>
                    <td>
                        <strong>Description</strong>
                    </td>
                    <td align="center">
                        <strong>Required</strong>
                    </td>
                </tr>
                <tr>
                    <td>
                        url
                    </td>
                    <td>
                        The URL to the model to be processed. (i.e.
                        jar:file:/path/to/my/model.xml.zip!/model.xmi)
                    </td>
                    <td align="center">
                        Yes
                    </td>
                </tr>
            </table>
            <table>
                <h2>
                    <a name="transformation"><![CDATA[<transformation>]]></a>
                </h2>
                <p> 
                    The <code><![CDATA[<transformation/>]]></code> is an <em>optional</em> 
                    element used to tell AndroMDA to apply an XSL transformation to the model(s) before
                    modeling processing occurs.  Note, that as many
                    transformations can be specified as you like, the transformations will be applied
                    in the order that they are specified in your build.xml.  Also note that any imports
                    are assumed to be relative to the transformation itself.
                </p>
                <p>
                    The transformation is an optional nested element.  
                </p>
                <tr>
                    <td>
                        <strong>Attribute</strong>
                    </td>
                    <td>
                        <strong>Description</strong>
                    </td>
                    <td align="center">
                        <strong>Required</strong>
                    </td>
                </tr>
                <tr>
                    <td>
                        url
                    </td>
                    <td>
                        The URL of the transformation to be applied. (i.e.
                        jar:file:/path/to/my/transformation/transformation.xsl)
                    </td>
                    <td align="center">
                        Yes
                    </td>
                </tr>
                <tr>
                    <td>
                        outputLocation
                    </td>
                    <td>
                        The location to which the result of the output will be written.
                        This is useful for debugging purposes, or if you need to "fix"
                        your model with a transformation.
                    </td>
                    <td>
                        No
                    </td>
                </tr>
            </table>
            <a name="andromda-example"/>
            <h3>Example</h3>
            <p>
                    This example call to the andromda task, tells AndroMDA to load 
                    the model from
                <em>jar:file:/path/to/my/model.zuml!/model.xmi</em>
                    and generate code using the hibernate, the ejb and bpm4struts cartridges. Notice
                    how we configure each cartridge through the
                <a href="#namespace">
                    <code><![CDATA[<namespace>]]></code>
                </a>
                    elements.
            </p>
            <source language="xml"><![CDATA[
<taskdef name="andromda"
         classname="org.andromda.ant.task.AndroMDAGenTask"
         classpathref="class.path"/>

<andromda>
    <model url="jar:file:/path/to/my/model1.zuml!/model1.xmi"/>
    <model url="jar:file:/path/to/my/model2.zuml!/model2.xmi"/>
    <!-- these are any XSL transformations to be applied to the model before
         model processing begins -->
    <transformation url="file:/path/to/my/transformation1.xsl"/>
    <transformation url="file:/path/to/my/transformation2.xsl" outputLocation="${basedir}/path/to/result/result.xml"/>
    <!-- defines the location of the mapping files -->
    <mappingsSearchPath>
        <pathelement location="${basedir}/src/mappings"/>
    </mappingsSearchPath>
    <!-- This example package will not be processed -->
    <modelPackage name="my::package::foo" shouldProcess="false"/>
    <namespace name="default" ignore="false">
        <!-- This file tells AndroMDA how to map abstract datatypes to classes -->
        <property name="languageMappingsUri" value="file:${basedir}/JavaMappings.xml"/>
    </namespace>
    <!-- This will generate the Hibernate code -->
    <namespace name="hibernate" ignore="false">
        <property name="jdbcMappingsUri" value="JDBC"/>
        <property name="sqlMappingsUri" value="HypersonicSql"/>
        <property name="foreignKeySuffix" value="_FK"/>
        <property name="maxSqlNameLength" value="30"/>
        <property name="entities"      value="${gen.src.dir}" ignore="false"/>
        <property name="entity-impls"  value="${gen.src.dir}" ignore="false"/>
        <property name="session-beans" value="${gen.src.dir}" ignore="false"/>
        <property name="session-impls" value="${gen.src.dir}" ignore="false"/>
    </namespace>
    <!-- This will generate the EJB code -->
    <namespace name="ejb" ignore="false">
        <property name="entities"      value="${gen.src.dir}" ignore="false"/>
        <property name="entity-impls"  value="${gen.src.dir}" ignore="false"/>
        <property name="session-beans" value="${gen.src.dir}" ignore="false"/>
        <property name="session-impls" value="${gen.src.dir}" ignore="false"/>
    </namespace>
    <!-- This will generate the Bpm4Struts code -->
    <namespace name="bpm4struts" ignore="false">
        <property name="securityEnabled" value="false"/>
        <property name="securityRealm" value="other"/>
        <property name="pages" value="${gen.src.dir}"/>
        <property name="forms" value="${gen.src.dir}"/>
        <property name="actions" value="${gen.src.dir}"/>
        <property name="controllers" value="${gen.src.dir}"/>
        <property name="controller-impls" value="${gen.src.dir}"/>
        <property name="messages" value="${gen.src.dir}"/>
        <property name="configuration" value="${gen.src.dir}"/>
        <property name="xdoclet-merge" value="${merge.src.dir}"/>
    </namespace>
</andromda>
            ]]></source>
            <h2>
                <a name="modelPackage"><![CDATA[<modelPackage>]]></a>
            </h2>
            <table>
                <p>
                    The
                    <code><![CDATA[<modelPackage>]]></code> is used in
                    conjunction with the
                    <code>
                        <a href="#processAllModelPackages">processAllModelPackages</a>
                    </code>
                    attribute of the
                    <code>
                        <a href="#andromda"><![CDATA[<andromda>]]></a>
                    </code>
                    task.  By default all packages are processed. Therefore it is recommended to 
                    turn off the packages which should be not processed.  In other words,
                    if you don't want to generate code from a certain package of a model, 
                    then you can create a modelPackage for that package, set the
                    <em>shouldProcess</em> attribute to
                    <code>false</code>, and any model
                    elements in that package will not be processed.
                </p>
                <p>
                    The modelPackage element is optional.
                </p>
                <tr>
                    <td>
                        <strong>Attribute</strong>
                    </td>
                    <td>
                        <strong>Description</strong>
                    </td>
                    <td align="center">
                        <strong>Required</strong>
                    </td>
                </tr>
                <tr>
                    <td>
                        name
                    </td>
                    <td>
                        The fully qualified name of the UML namespace/package.
                    </td>
                    <td align="center">
                        Yes.
                    </td>
                </tr>
                <tr>
                    <td>
                        shouldProcess
                    </td>
                    <td>
                        True or false depending on whether or not the package
                        should be processed.
                    </td>
                    <td align="center">
                        No. Defaults to
                        <code>true</code>.
                    </td>
                </tr>
            </table>
            <h3>Example</h3>
            <p>
                The below example demonstrates the correct use of the <![CDATA[<modelPackage>]]>
                element:
            </p>
            <source language="xml"><![CDATA[
<andromda>
  ...
    <modelPackage name="my::package::foo" shouldProcess="true"/>
    <modelPackage name="my::package::bar" shouldProcess="false"/>
  ...
</andromda>
                ]]></source>
            <p>
                The above is equivalent to:
            </p>
            <source language="xml"><![CDATA[
<andromda>
  ...
    <modelPackage name="my::package::bar" shouldProcess="false"/>
  ...
</andromda>
                ]]></source>
            <h2>
                <a name="namespace"><![CDATA[<namespace>]]></a>
            </h2>
            <p>
                The
                <a href="#andromda">
                    <code><![CDATA[<andromda>]]></code>
                </a> task takes a
                nested
                <code><![CDATA[<namespace>]]></code> element in order to customize
                the properties of a cartridge.  These properties are used to define the 
                location of where generated files are written, what language mapping files
                to use (i.e. JavaMappings.xml, DotNetMappings.xml, etc.) and any other
                properties that a cartridge and its metafacades might support.
            </p>
            <h3>Attributes</h3>
            <table>
                <tr>
                    <td>
                        <strong>Attribute</strong>
                    </td>
                    <td>
                        <strong>Description</strong>
                    </td>
                    <td align="center">
                        <strong>Required</strong>
                    </td>
                </tr>
                <tr>
                    <td>
                        name
                    </td>
                    <td>
                        The name of the cartridge you want to use. It must match the name 
                        in a cartridge descriptor (i.e.
                        <em>/META-INF/andromda-cartridge.xml</em>).
                    </td>
                    <td>
                        Yes.
                    </td>
                </tr>
                <tr>
                    <td>
                        ignore
                    </td>
                    <td>
                        This is useful if you have a cartridge on your classpath 
                        (since cartridge's are loaded when on your classpath) and you do
                        not want to generate any output from this cartridge, in other
                        words, you want it to be ignored.  If you want to ignore
                        a cartridge, then set this attribute with value of
                        <code>true</code>,
                        otherwise don't set it at all.
                    </td>
                    <td align="center">
                        No. Defaults to
                        <code>false</code>.
                    </td>
                </tr>
            </table>
            <p>
                See the
                <a href="#andromda-example">example</a> above for the correct use of
                namespace elements.
            </p>
            <h2>
                <a name="repository"><![CDATA[<repository>]]></a>
            </h2>
            <p>
                The
                <a href="#andromda">
                    <code><![CDATA[<andromda>]]></code>
                </a> task supports a nested
                <code><![CDATA[<repository>]]></code> tag to
                use to define any extra repository options (i.e. moduleSearchPath).
            </p>
            <h2>
                <a name="moduleSearchPath"><![CDATA[<moduleSearchPath>]]></a>
            </h2>
            <p>
                The
                <a href="#repository">
                    <code><![CDATA[<repository>]]></code>
                </a> element
                takes a nested
                <code><![CDATA[<moduleSearchPath>]]></code> element in order
                to define the location of external modules or profiles that a model being 
                processed is using.  The
                <code><![CDATA[<moduleSearchPath>]]></code> takes
                any valid Ant path element structures.  See
                <a href="http://ant.apache.org/manual/using.html#path">Path-like Structures</a>
                for more information on how to define these paths.
            </p>
            <h3>Example</h3>
            <p>
                The BPM4Struts cartridge metafacade model 
                extends from the base metafacade model, so we define a
                <code><![CDATA[<moduleSearchPath>]]></code> element pointing to
                the location for which to find the base metafacade model.
            </p>
            <source language="xml">
                <![CDATA[
<andromda lastModifiedCheck="false">
    <model url="jar:file:${src.dir}/uml/BPM4StrutsMetafacadeModel.xml.zip!/BPM4StrutsMetafacadeModel.xml"/>
    <repository>
        <moduleSearchPath>
            <pathelement location="${basedir}/lib"/>
        </moduleSearchPath>
    </repository>
    ...
</andromda>
                ]]>
            </source>
            <h2>
                <a name="mappingsSearchPath"><![CDATA[<mappingsSearchPath>]]></a>
            </h2>
            <p>
                The
                <a href="#AndroMDA">
                    <code><![CDATA[<andromda>]]></code>
                </a> element takes a nested
                <code><![CDATA[<mappingsSearchPath>]]></code> element in order
                to define the location of AndroMDA mapping files.  This allows
                us to use the <code>logical</code> names for the location of
                mapping files (instead of the complete path). The
                <code><![CDATA[<mappingsSearchPath>]]></code> takes
                any valid Ant path element structures.  See
                <a href="http://ant.apache.org/manual/using.html#path">Path-like Structures</a>
                for more information on how to define these paths.
            </p>
            <p class="highlight">
                Please Note: The logical name is the value of the <em>name</em> attribute within an the actual mappings
                file on the <em><![CDATA[<mappings/>]]></em> element.
            </p>
            <h3>Example</h3>
            <p>
                We want to define the location of the mapping files so that we
                use the logical name of mapping, files therefore we create a 
                <code><![CDATA[<mappingsSearchPath>]]></code> element pointing to
                the location for which to find all AndroMDA mapping files we'll be
                using.  Note how we are able to use logical names such as <code>JDBC</code>
                and <code>HypersonicSql</code> instead of the complete paths.
            </p>
            <source language="xml">
                <![CDATA[
<andromda lastModifiedCheck="false">
    <model url="jar:file:/path/to/my/model.zuml!/model.xmi"/>
    <mappingsSearchPath>
        <pathelement location="${basedir}/src/mappings"/>
    </mappingsSearchPath>
    ...
    <!-- This will generate the Hibernate code -->
    <namespace name="hibernate" ignore="false">
        <property name="jdbcMappingsUri" value="JDBC"/>
        <property name="sqlMappingsUri" value="HypersonicSql"/>
        ...
    </namespace>
    ...
</andromda>
                ]]>
            </source>
        </section>
    </body>
</document>
